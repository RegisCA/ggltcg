#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."

# Check if frontend has changes
if git diff --cached --name-only origin/main...HEAD | grep -q "^frontend/"; then
  echo "ğŸ“¦ Frontend changes detected, running build check..."
  cd frontend
  npm run build
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend build failed! Fix TypeScript errors before pushing."
    exit 1
  fi
  echo "âœ… Frontend build succeeded"
  cd ..
fi

# Run backend tests
if git diff --cached --name-only origin/main...HEAD | grep -q "^backend/"; then
  echo "ğŸ§ª Backend changes detected, running tests..."
  cd backend
  source ../.venv/bin/activate 2>/dev/null || true
  python -m pytest tests/ -q --tb=short
  if [ $? -ne 0 ]; then
    echo "âŒ Backend tests failed! Fix tests before pushing."
    exit 1
  fi
  echo "âœ… Backend tests passed"
  cd ..
fi

echo "ğŸš€ All pre-push checks passed!"
